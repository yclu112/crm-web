import{_ as e}from"./index.vue_vue_type_script_setup_true_name_ProTable_lang-25415f8a.js";import{C as a}from"./index-d897ae39.js";import{G as i,I as t,a as l,b as s,F as o}from"./enum-ebf888b2.js";import{C as r,d as n,r as c,a as p,b as d,c as m,o as u,e as b,f as h,D as y,w as v,g as w,h as f,i as _,u as g,m as k,G as C,H as x,n as W,s as j,z as O,I as P}from"./index-6dfdc0ee.js";import{_ as S}from"./CustomerDialog.vue_vue_type_script_setup_true_lang-a24c0c3c.js";import{u as H}from"./useHandleData-bcc6e8c1.js";const L={class:"table-box"},T=n({__name:"CustomerManage",props:{isShowHeader:{type:Boolean,default:!0}},setup(n,{expose:T}){const R=c(),B=n;T({proTable:R});const D=p({isPublic:0}),U=c(0),E=e=>(U.value=e.list.size,{list:e.list,total:e.total}),G=[{type:"selection",fixed:"left",width:60},{prop:"name",label:"客户名称",minWidth:120,search:{el:"input"}},{prop:"phone",label:"手机号",minWidth:160,search:{el:"input"}},{prop:"email",label:"邮箱",minWidth:120},{prop:"gender",label:"性别",enum:Object.values(i),minWidth:120},{prop:"isKeyDecisionMaker",label:"是否为关键决策人",enum:Object.values(t),minWidth:140},{prop:"dealCount",label:"成交次数",minWidth:120},{prop:"level",label:"客户级别",enum:Object.values(l),minWidth:120,search:{el:"select"}},{prop:"source",label:"客户来源",enum:Object.values(s),minWidth:120,search:{el:"select"}},{prop:"address",label:"客户地址",minWidth:180},{prop:"followStatus",label:"跟进状态",enum:Object.values(o),minWidth:120},{prop:"nextFollowStatus",label:"下次跟进时间",minWidth:200},{prop:"createrName",label:"创建人",minWidth:120},{prop:"ownerName",label:"客户所属员工名称",minWidth:140},{prop:"remark",label:"备注",minWidth:200},{prop:"createTime",label:"创建时间",width:200},{prop:"operation",label:"操作",fixed:"right",width:330,isShow:B.isShowHeader}],I=c(),q=(e,i={})=>{let t={title:e,row:{...i},isView:"查看"===e,api:a.saveOrEdit,getTableList:R.value.getTableList,maxHeight:"450px"};I.value.acceptParams(t)},z=async e=>{await H(a.remove,e,"删除所选客户"),R.value.clearSelection(),R.value.getTableList()},A=async()=>{0===U.value?O({type:"warning",message:"暂无客户数据需要导出"}):(D&&(R.value.searchParam.isPublic=D.isPublic),P.confirm("确认导出客户记录吗?","温馨提示",{type:"warning"}).then(()=>{var e;return(async(e,a,i={},t=!0,l=".xls")=>{t&&r({title:"温馨提示",message:"如果数据庞大会导致下载缓慢哦，请您耐心等待！",type:"info",duration:3e3});try{const t=await e(i),s=new Blob([t]);if("msSaveOrOpenBlob"in navigator)return window.navigator.msSaveOrOpenBlob(s,a+l);const o=window.URL.createObjectURL(s),r=document.createElement("a");r.style.display="none",r.download=`${a}${l}`,r.href=o,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(o)}catch(s){}})(a.export,"客户列表",null==(e=R.value)?void 0:e.searchParam)}))};return(i,t)=>{const l=d("el-button"),s=m("hasPermi");return u(),b("div",L,[h(e,{ref_key:"proTable",ref:R,title:"客户列表",columns:G,requestApi:g(a).page,initParam:D,dataCallback:E,searchCol:{xs:2,sm:3,md:4,lg:6,xl:8}},y({_:2},[B.isShowHeader?{name:"tableHeader",fn:v(e=>[w((u(),f(l,{type:"primary",icon:g(k),onClick:t[0]||(t[0]=e=>q("新增"))},{default:v(()=>[...t[1]||(t[1]=[_("新增客户",-1)])]),_:1},8,["icon"])),[[s,["sys:customer:add"]]]),w((u(),f(l,{type:"primary",icon:g(C),plain:"",onClick:A},{default:v(()=>[...t[2]||(t[2]=[_("导出客户",-1)])]),_:1},8,["icon"])),[[s,["sys:customer:export"]]]),w((u(),f(l,{type:"danger",icon:g(x),disabled:!e.isSelected,onClick:a=>z(e.selectedListIds)},{default:v(()=>[...t[3]||(t[3]=[_("批量删除",-1)])]),_:1},8,["icon","disabled","onClick"])),[[s,["sys:customer:remove"]]])]),key:"0"}:void 0,B.isShowHeader?{name:"operation",fn:v(e=>[w((u(),f(l,{type:"primary",link:"",icon:g(W),onClick:a=>q("编辑",e.row)},{default:v(()=>[...t[4]||(t[4]=[_("编辑",-1)])]),_:1},8,["icon","onClick"])),[[s,["sys:customer:edit"]]]),w((u(),f(l,{type:"danger",link:"",icon:g(x),onClick:a=>z([e.row.id])},{default:v(()=>[...t[5]||(t[5]=[_("删除",-1)])]),_:1},8,["icon","onClick"])),[[s,["sys:customer:remove"]]]),w((u(),f(l,{type:"warning",link:"",icon:g(j),onClick:i=>(async e=>{await H(a.toPublic,{id:e},"转入公海"),R.value.clearSelection(),R.value.getTableList()})(e.row.id)},{default:v(()=>[...t[6]||(t[6]=[_("转入公海",-1)])]),_:1},8,["icon","onClick"])),[[s,["sys:customer:share"]]])]),key:"1"}:void 0]),1032,["requestApi","initParam"]),h(S,{ref_key:"dialogRef",ref:I},null,512)])}}});export{T as _};
