import{J as e,K as l,d as a,r as t,a1 as i,a2 as s,a3 as r,b as u,o,e as d,f as n,w as p,F as c,v as m,q as v,a4 as g,t as f,a5 as h,h as w,C as b,a6 as _,a7 as y,a8 as x,a as k,B as V,u as U,x as q,i as C,g as j,y as I,z as T}from"./index-6dfdc0ee.js";import{_ as $}from"./Dialog.vue_vue_type_style_index_0_lang-6e721bb1.js";import{P as z}from"./enum-ebf888b2.js";import{_ as E}from"./_plugin-vue_export-helper-1b428a4d.js";const F=a=>e.post(l+"/common/upload/file",a,{headers:{"Content-Type":"multipart/form-data"}}),D={class:"upload-box"},P=["src"],S={key:1,class:"upload-empty"},B={class:"el-upload__tip"},M=E(a({__name:"Img",props:{imageUrl:{default:""},api:{},drag:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},fileSize:{default:5},fileType:{default:()=>["image/jpeg","image/png","image/gif"]},height:{default:"150px"},width:{default:"150px"},borderRadius:{default:"8px"}},emits:["update:imageUrl","check-validate"],setup(e,{emit:l}){_(e=>({v7f0cd6f0:e.width,v34ea02a5:e.height,a2565248:e.borderRadius}));const a=e,k=t("id-"+i()),V=t(!1),U=s(y,void 0),q=s(x,void 0),C=r(()=>a.disabled||(null==U?void 0:U.disabled)),j=l,I=async e=>{let l=new FormData;l.append("file",e.file);try{const e=a.api??F,{data:t}=await e(l);j("update:imageUrl",t.fileUrl),(null==q?void 0:q.prop)&&(null==U||U.validateField([q.prop])),j("check-validate")}catch(t){e.onError(t)}},T=()=>{j("update:imageUrl","")},$=()=>{const e=document.querySelector(`#${k.value} .el-upload__input`);e&&e.dispatchEvent(new MouseEvent("click"))},z=e=>{const l=e.size/1024/1024<a.fileSize,t=a.fileType;return t.includes(e.type)||b({title:"温馨提示",message:"上传图片不符合所需的格式！",type:"warning"}),l||b({title:"温馨提示",message:`上传图片大小不能超过 ${a.fileSize}M！`,type:"warning"}),t.includes(e.type)&&l},E=()=>{b({title:"温馨提示",message:"图片上传成功！",type:"success"})},M=()=>{b({title:"温馨提示",message:"图片上传失败，请您重新上传！",type:"error"})};return(l,a)=>{const t=u("Edit"),i=u("el-icon"),s=u("ZoomIn"),r=u("Delete"),b=u("Plus"),_=u("el-upload"),y=u("el-image-viewer");return o(),d("div",D,[n(_,{action:"#",id:k.value,class:h(["upload",C.value?"disabled":"",e.drag?"no-border":""]),multiple:!1,disabled:C.value,"show-file-list":!1,"http-request":I,"before-upload":z,"on-success":E,"on-error":M,drag:e.drag,accept:e.fileType.join(",")},{default:p(()=>[e.imageUrl?(o(),d(c,{key:0},[m("img",{src:e.imageUrl,class:"upload-image"},null,8,P),m("div",{class:"upload-handle",onClick:a[1]||(a[1]=g(()=>{},["stop"]))},[C.value?v("",!0):(o(),d("div",{key:0,class:"handle-icon",onClick:$},[n(i,null,{default:p(()=>[n(t)]),_:1}),a[3]||(a[3]=m("span",null,"编辑",-1))])),m("div",{class:"handle-icon",onClick:a[0]||(a[0]=e=>V.value=!0)},[n(i,null,{default:p(()=>[n(s)]),_:1}),a[4]||(a[4]=m("span",null,"查看",-1))]),C.value?v("",!0):(o(),d("div",{key:1,class:"handle-icon",onClick:T},[n(i,null,{default:p(()=>[n(r)]),_:1}),a[5]||(a[5]=m("span",null,"删除",-1))]))])],64)):(o(),d("div",S,[f(l.$slots,"empty",{},()=>[n(i,null,{default:p(()=>[n(b)]),_:1})],!0)]))]),_:3},8,["id","class","disabled","drag","accept"]),m("div",B,[f(l.$slots,"tip",{},void 0,!0)]),V.value?(o(),w(y,{key:0,onClose:a[2]||(a[2]=e=>V.value=!1),"url-list":[e.imageUrl]},null,8,["url-list"])):v("",!0)])}}}),[["__scopeId","data-v-ff9e09c6"]]),N={class:"flex"},R=a({__name:"ProductDialog",setup(e,{expose:l}){const a=t(!1),i=t({isView:!1,title:"",row:{},labelWidth:120,fullscreen:!1,maxHeight:"500px"});l({acceptParams:e=>{e.row={...i.value.row,...e.row},i.value={...i.value,...e},a.value=!0}});const s=k({name:[{required:!0,message:"请输入商品名称",trigger:"blur"}],price:[{required:!0,message:"请输入商品价格",trigger:"blur"},{pattern:/^\d+(\.\d{1,2})?$/,message:"商品价格最多小数点后两位",trigger:"blur"}],stock:[{required:!0,message:"请输入商品库存数量",trigger:"blur"},{validator:(e,l,a)=>{const t=Number(l);isNaN(t)?a(new Error("请输入数字")):t<0?a(new Error("商品库存不能小于0")):a()},trigger:"blur"}],status:[{required:!0,message:"请选择商品状态",trigger:"blur"}],coverImage:[{required:!0,message:"请上传商品封面图",trigger:"blur"}]}),r=t(),v=()=>{r.value.validate(async e=>{if(e)try{delete i.value.row.updateTime,delete i.value.row.createTime,await i.value.api(i.value.row),T.success({message:`${i.value.title}成功！`}),i.value.getTableList(),a.value=!1,r.value.resetFields(),g(!0)}catch(l){}})},g=e=>{a.value=!1;(["查看","编辑"].includes(i.value.title)||e)&&(i.value.row={},r.value.resetFields())};return(e,l)=>{const t=u("el-input"),h=u("el-form-item"),b=u("el-option"),_=u("el-select"),y=u("Avatar"),x=u("el-icon"),k=u("el-form"),T=u("el-button");return o(),w(U($),{"model-value":a.value,title:i.value.title,fullscreen:i.value.fullscreen,"max-height":i.value.maxHeight,"cancel-dialog":g,width:"50%"},{footer:p(()=>[f(e.$slots,"footer",{},()=>[n(T,{onClick:g},{default:p(()=>[...l[7]||(l[7]=[C("取消",-1)])]),_:1}),j(n(T,{type:"primary",onClick:v},{default:p(()=>[...l[8]||(l[8]=[C("确定",-1)])]),_:1},512),[[I,!i.value.isView]])])]),default:p(()=>[m("div",{style:q("width: calc(100% - "+i.value.labelWidth/2+"px)")},[n(k,{ref_key:"ruleFormRef",ref:r,"label-position":"right","label-width":i.value.labelWidth+"px",rules:s,model:i.value.row,disabled:i.value.isView,"hide-required-asterisk":i.value.isView},{default:p(()=>[n(h,{label:"商品名称",prop:"name"},{default:p(()=>[n(t,{modelValue:i.value.row.name,"onUpdate:modelValue":l[0]||(l[0]=e=>i.value.row.name=e),placeholder:"请填写商品名称",clearable:"",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),m("div",N,[n(h,{label:"商品价格",prop:"price"},{default:p(()=>[n(t,{modelValue:i.value.row.price,"onUpdate:modelValue":l[1]||(l[1]=e=>i.value.row.price=e),placeholder:"请填写商品价格",type:"number",clearable:"",maxlength:"10","show-word-limit":""},null,8,["modelValue"])]),_:1}),n(h,{label:"商品库存",prop:"stock"},{default:p(()=>[n(t,{modelValue:i.value.row.stock,"onUpdate:modelValue":l[2]||(l[2]=e=>i.value.row.stock=e),placeholder:"请填写商品库存",clearable:"",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1})]),n(h,{label:"商品状态",prop:"status"},{default:p(()=>[n(_,{modelValue:i.value.row.status,"onUpdate:modelValue":l[3]||(l[3]=e=>i.value.row.status=e),filterable:"",placeholder:"请选择商品状态",class:"w-full"},{default:p(()=>[(o(!0),d(c,null,V(Object.values(U(z)),e=>(o(),w(b,{key:e.value,label:e.label,value:e.value,class:"isabel-option"},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(h,{label:"商品封面图",prop:"coverImage"},{default:p(()=>[n(M,{"image-url":i.value.row.coverImage,"onUpdate:imageUrl":l[4]||(l[4]=e=>i.value.row.coverImage=e),width:"135px",height:"135px","file-size":5},{empty:p(()=>[n(x,null,{default:p(()=>[n(y)]),_:1}),l[6]||(l[6]=m("span",null,"请上传商品封面图",-1))]),_:1},8,["image-url"])]),_:1}),n(h,{label:"商品简介",prop:"description"},{default:p(()=>[n(t,{modelValue:i.value.row.description,"onUpdate:modelValue":l[5]||(l[5]=e=>i.value.row.description=e),placeholder:"请填写商品简介",clearable:"",maxlength:"100","show-word-limit":"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["label-width","rules","model","disabled","hide-required-asterisk"])],4)]),_:3},8,["model-value","title","fullscreen","max-height"])}}});export{R as _};
