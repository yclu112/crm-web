import{d as e,r as a,aL as l,a as t,b as r,o as u,h as s,w as i,t as o,v as d,f as n,x as c,u as m,i as v,g as f,y as p,z as h}from"./index-6dfdc0ee.js";import{_ as w}from"./Dialog.vue_vue_type_style_index_0_lang-6e721bb1.js";import{c as _}from"./index-92b7ec21.js";import{_ as g}from"./_plugin-vue_export-helper-1b428a4d.js";const b=g(e({__name:"RoleDialog",async setup(e,{expose:g}){let b,y;const k=a(!1),x=a({isView:!1,title:"",row:{},labelWidth:160,fullscreen:!1,maxHeight:"500px"}),V=a(!0);g({acceptParams:e=>{e.row={...x.value.row,...e.row},x.value={...x.value,...e},k.value=!0,setTimeout(()=>{V.value=!1},200)}});[b,y]=l(()=>(async()=>{const{data:e}=await _();x.value.treeMenuList=e})()),await b,y();const L=t({name:[{required:!0,message:"请填写角色名称",trigger:"blur"},{max:10,message:"字数为2-10个字",trigger:"blur"}],menuIds:[{required:!0,validator:(e,a,l)=>H().length<=0?l(new Error("请选择权限")):l()}]}),I=a(),j=()=>{I.value.validate(async e=>{if(e)try{x.value.row.menuIds=H(),await x.value.api(x.value.row),h.success({message:`${x.value.title}角色成功！`}),x.value.getTableList(),q(!0)}catch(a){}})},q=e=>{k.value=!1;(["查看","编辑"].includes(x.value.title)||e)&&(x.value.row={},I.value.resetFields()),V.value=!0},C={children:"children",label:"title",class:(e,a)=>{if(a.isLeaf)return"";let l=!0;for(const t in a.childNodes)a.childNodes[t].isLeaf||(l=!1);return l?"penultimate-node":""}},M=a(),H=()=>M.value.getCheckedKeys().concat(M.value.getHalfCheckedKeys());return(e,a)=>{const l=r("el-input"),t=r("el-form-item"),h=r("el-tree"),_=r("el-form"),g=r("el-button");return u(),s(m(w),{"model-value":k.value,title:x.value.title,fullscreen:x.value.fullscreen,"max-height":x.value.maxHeight,"cancel-dialog":q},{footer:i(()=>[o(e.$slots,"footer",{},()=>[n(g,{onClick:q},{default:i(()=>[...a[2]||(a[2]=[v("取消",-1)])]),_:1}),f(n(g,{type:"primary",onClick:j},{default:i(()=>[...a[3]||(a[3]=[v("确定",-1)])]),_:1},512),[[p,!x.value.isView]])],!0)]),default:i(()=>[d("div",{style:c("width: calc(100% - "+x.value.labelWidth/2+"px)")},[n(_,{ref_key:"ruleFormRef",ref:I,"label-position":"right","label-width":x.value.labelWidth+"px",rules:L,model:x.value.row,disabled:x.value.isView,"hide-required-asterisk":x.value.isView},{default:i(()=>[n(t,{label:"角色名称",prop:"name"},{default:i(()=>[n(l,{modelValue:x.value.row.name,"onUpdate:modelValue":a[0]||(a[0]=e=>x.value.row.name=e),placeholder:"请填写角色名称（10字以内）",clearable:""},null,8,["modelValue"])]),_:1}),n(t,{label:"角色备注",prop:"remark"},{default:i(()=>[n(l,{modelValue:x.value.row.remark,"onUpdate:modelValue":a[1]||(a[1]=e=>x.value.row.remark=e),placeholder:"请填写角色备注（30字以内）",clearable:""},null,8,["modelValue"])]),_:1}),n(t,{label:"菜单权限",prop:"menuIds"},{default:i(()=>[n(h,{ref_key:"treeRef",ref:M,key:"roleMenuKey",data:x.value.treeMenuList,"default-checked-keys":x.value.row.menuIds,props:C,"show-checkbox":"","default-expand-all":"","node-key":"id","check-strictly":V.value},null,8,["data","default-checked-keys","check-strictly"])]),_:1})]),_:1},8,["label-width","rules","model","disabled","hide-required-asterisk"])],4)]),_:3},8,["model-value","title","fullscreen","max-height"])}}}),[["__scopeId","data-v-a9ada19b"]]);export{b as default};
