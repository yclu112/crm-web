import{d as e,ae as l,T as a,r,aL as t,a as s,b as u,o,h as d,w as i,t as m,v as p,f as n,q as v,e as w,B as c,F as g,u as b,i as f,x as h,g as _,y,z as V}from"./index-6dfdc0ee.js";import{_ as x}from"./Dialog.vue_vue_type_style_index_0_lang-6e721bb1.js";import{g as k}from"./index-92b7ec21.js";import{g as q}from"./index-9223e28c.js";const I=e({__name:"ManagerDialog",async setup(e,{expose:I}){let U,P;const $=l().departmentList,L=a(),j=r(!1),F=r({isView:!1,title:"",row:{status:1,type:0,email:""},labelWidth:160,fullscreen:!1,maxHeight:"500px"});I({acceptParams:e=>{e.row={...F.value.row,...e.row},F.value={...F.value,...e},j.value=!0}});[U,P]=t(()=>(async()=>{const{data:e}=await k();F.value.roleList=e})()),await U,P();const z=s({account:[{required:!0,message:"用户名不能为空",trigger:"blur"},{min:2,max:20,message:"字数为2-20个字"}],nickname:[{required:!0,message:"昵称不能为空",trigger:"blur"},{min:2,max:20,message:"字数为2-20个字"}],password:[{required:!0,trigger:"blur",message:"密码不能为空"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[._~!@#$^&*])[A-Za-z0-9._~!@#$^&*]{8,16}$/,message:"密码应当至少8位且含有数字、大小写字母及特殊字符"}],submitPassword:[{required:!0,validator:(e,l,a)=>l?F.value.row.password&&F.value.row.submitPassword&&F.value.row.password!==F.value.row.submitPassword?a(new Error("两次输入的密码不一致")):a():a(new Error("确认密码不能为空")),trigger:["blur"]}],roleId:[{required:!0,message:"请选择角色",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}],type:[{required:!0,message:"请选择账号类型",trigger:"change"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式（如：xxx@example.com）",trigger:"blur"}]}),W=r(),A=()=>{W.value.validate(async e=>{if(e)try{await F.value.api(F.value.row).then(e=>{F.value.row.Id===L.$state.userInfo.Id&&q().then(e=>{L.setUserinfo(e.data)})}),V.success({message:`${F.value.title}管理员成功！`}),F.value.getTableList(),j.value=!1,W.value.resetFields(),C(!0)}catch(l){}})},C=e=>{j.value=!1;(["查看","编辑"].includes(F.value.title)||e)&&(F.value.row={status:1,type:0},W.value.resetFields())};return(e,l)=>{const a=u("el-input"),r=u("el-form-item"),t=u("el-option"),s=u("el-select"),V=u("el-cascader"),k=u("el-radio"),q=u("el-radio-group"),I=u("el-form"),U=u("el-button");return o(),d(b(x),{"model-value":j.value,title:F.value.title,fullscreen:F.value.fullscreen,"max-height":F.value.maxHeight,"cancel-dialog":C,width:"45%"},{footer:i(()=>[m(e.$slots,"footer",{},()=>[n(U,{onClick:C},{default:i(()=>[...l[10]||(l[10]=[f("取消",-1)])]),_:1}),_(n(U,{type:"primary",onClick:A},{default:i(()=>[...l[11]||(l[11]=[f("确定",-1)])]),_:1},512),[[y,!F.value.isView]])])]),default:i(()=>[p("div",{style:h("width: calc(100% - "+F.value.labelWidth/2+"px)")},[n(I,{ref_key:"ruleFormRef",ref:W,"label-position":"right","label-width":F.value.labelWidth+"px",rules:z,model:F.value.row,disabled:F.value.isView,"hide-required-asterisk":F.value.isView},{default:i(()=>["重置"!==F.value.title?(o(),d(r,{key:0,label:"用户名",prop:"account"},{default:i(()=>[n(a,{modelValue:F.value.row.account,"onUpdate:modelValue":l[0]||(l[0]=e=>F.value.row.account=e),placeholder:"请填写用户名（2-20字）",clearable:""},null,8,["modelValue"])]),_:1})):v("",!0),"重置"!==F.value.title?(o(),d(r,{key:1,label:"昵称",prop:"nickname"},{default:i(()=>[n(a,{modelValue:F.value.row.nickname,"onUpdate:modelValue":l[1]||(l[1]=e=>F.value.row.nickname=e),placeholder:"请填写昵称（2-20字）",clearable:""},null,8,["modelValue"])]),_:1})):v("",!0),"重置"!==F.value.title?(o(),d(r,{key:2,label:"邮箱",prop:"email"},{default:i(()=>[n(a,{modelValue:F.value.row.email,"onUpdate:modelValue":l[2]||(l[2]=e=>F.value.row.email=e),placeholder:"请填写邮箱（用于接收合同审核通知）",clearable:""},null,8,["modelValue"])]),_:1})):v("",!0),"新增"===F.value.title||"重置"===F.value.title?(o(),d(r,{key:3,label:"密码",prop:"password"},{default:i(()=>[n(a,{modelValue:F.value.row.password,"onUpdate:modelValue":l[3]||(l[3]=e=>F.value.row.password=e),"show-password":"",type:"password",placeholder:"请填写密码"},null,8,["modelValue"])]),_:1})):v("",!0),"新增"===F.value.title||"重置"===F.value.title?(o(),d(r,{key:4,label:"确认密码",prop:"submitPassword"},{default:i(()=>[n(a,{modelValue:F.value.row.submitPassword,"onUpdate:modelValue":l[4]||(l[4]=e=>F.value.row.submitPassword=e),"show-password":"",type:"password",placeholder:"请填写密码"},null,8,["modelValue"])]),_:1})):v("",!0),"重置"!==F.value.title&&0==F.value.row.type?(o(),d(r,{key:5,label:"角色",prop:"roleId"},{default:i(()=>[n(s,{modelValue:F.value.row.roleId,"onUpdate:modelValue":l[5]||(l[5]=e=>F.value.row.roleId=e),filterable:"",placeholder:"请选择角色",class:"w-full"},{default:i(()=>[(o(!0),w(g,null,c(F.value.roleList,e=>(o(),d(t,{key:e.Id,label:e.name,value:e.id,class:"isabel-option"},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):v("",!0),"重置"!==F.value.title?(o(),d(r,{key:6,label:"所属部门",prop:"departId"},{default:i(()=>[n(V,{modelValue:F.value.row.departId,"onUpdate:modelValue":l[6]||(l[6]=e=>F.value.row.departId=e),props:{value:"id",label:"name",emitPath:!1,checkStrictly:!0},placeholder:"请选择管理员所属部门",options:b($),"show-all-levels":!1,filterable:""},null,8,["modelValue","options"])]),_:1})):v("",!0),"重置"!==F.value.title?(o(),d(r,{key:7,label:"状态",prop:"status"},{default:i(()=>[n(q,{modelValue:F.value.row.status,"onUpdate:modelValue":l[7]||(l[7]=e=>F.value.row.status=e)},{default:i(()=>[n(k,{label:1,border:""},{default:i(()=>[...l[8]||(l[8]=[f("正常",-1)])]),_:1}),n(k,{label:0,border:""},{default:i(()=>[...l[9]||(l[9]=[f("停用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):v("",!0)]),_:1},8,["label-width","rules","model","disabled","hide-required-asterisk"])],4)]),_:3},8,["model-value","title","fullscreen","max-height"])}}});export{I as _};
